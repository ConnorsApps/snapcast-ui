FROM debian:bullseye

WORKDIR /app

RUN apt-get update
RUN apt-get install -y wget

RUN rm -rf /var/lib/apt/lists/*

RUN apkArch="$(dpkg --print-architecture)"; \
    case "$apkArch" in \
    arm64) \
    wget https://github.com/badaix/snapcast/releases/download/v0.26.0/snapclient_0.26.0-1_armhf.deb \
            -O ./snapclient.deb   \
    && wget https://github.com/badaix/snapcast/releases/download/v0.26.0/snapserver_0.26.0-1_armhf.deb \
            -O ./snapserver.deb  \
    ;; \
    amd64) \
    wget https://github.com/badaix/snapcast/releases/download/v0.26.0/snapclient_0.26.0-1_amd64.deb \
            -O ./snapclient.deb  \
    && wget https://github.com/badaix/snapcast/releases/download/v0.26.0/snapserver_0.26.0-1_amd64.deb \
            -O ./snapserver.deb  \
    ;; \
    esac;

RUN apt install ./snapclient.deb -y
RUN apt install ./snapserver.deb -y

COPY .docker/snapserver.conf /etc/snapserver.conf
COPY .docker/snapclient2.conf /lib/systemd/system/snapclient2.service

RUN systemctl enable snapclient
RUN systemctl start snapclient
RUN systemctl restart snapclient

RUN systemctl enable snapserver
RUN systemctl start snapserver
RUN systemctl restart snapserver

CMD tail -f /dev/null