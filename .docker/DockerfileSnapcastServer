FROM debian:bullseye

ARG INSTANCE=1

WORKDIR /app

RUN dpkg --add-architecture armhf

RUN apt update && apt upgrade
RUN apt install -y wget

RUN apkArch="$(dpkg --print-architecture)"; \
    case "$apkArch" in \
    arm64) \
    wget https://github.com/badaix/snapcast/releases/download/v0.26.0/snapserver_0.26.0-1_armhf.deb -O ./snapserver.deb;; \
    amd64) \
    wget https://github.com/badaix/snapcast/releases/download/v0.26.0/snapserver_0.26.0-1_amd64.deb -O ./snapserver.deb;; \
    esac;

RUN apt install ./snapserver.deb -y

RUN rm -rf /var/lib/apt/lists/*

COPY .docker/snapserver.conf /etc/snapserver.conf

CMD /usr/bin/snapserver --logging.sink=system --instance $INSTANCE